(("undefined"!==typeof self?self:this)["webpackChunkharvester_1_6_0"]=("undefined"!==typeof self?self:this)["webpackChunkharvester_1_6_0"]||[]).push([[472],{14472:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return de}});var r=a(9274);const o={key:0,class:"upgrade"},s={class:"upgrade-info mb-10"},n={key:0,class:"repoInfo"},l={class:"row"},c={class:"col span-12"},d=["href"],i={key:0,class:"row mb-5"},p={class:"col span-12"},g={class:"state"},u={key:1,class:"row mb-5"},m={class:"col span-12"},h={class:"state"},v={class:"error ml-5"},f={class:"row mb-5"},y={class:"col span-6"},N={class:"text-muted"},V={class:"col span-6"},E={class:"text-muted"},w={class:"row mb-5"},b={class:"col span-6"},k={class:"text-muted"},S={class:"col span-6"},R={class:"text-muted"},D={class:"row mb-5"},x={class:"col span-6"},P={class:"text-muted"},B={class:"col span-6"},C={class:"text-muted"},I={key:1,class:"text-error mb-20"},L={key:2},M={class:"float-r text-info"},A={class:"text-warning"},U={class:"float-r text-info"},_={key:3,class:"text-warning"},G={class:"footer"},F=["disabled"];function T(e,t,a,T,$,O){const z=(0,r.resolveComponent)("BadgeStateFormatter"),H=(0,r.resolveComponent)("PercentageBar"),W=(0,r.resolveComponent)("ProgressBarList"),j=(0,r.resolveComponent)("v-dropdown"),K=(0,r.resolveDirective)("clean-tooltip");return O.enabled&&O.isShow?((0,r.openBlock)(),(0,r.createElementBlock)("div",o,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(j,{"popper-class":"upgrade-header-dropdown",class:"hand"},{popper:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",s,[O.repoInfo?((0,r.openBlock)(),(0,r.createElementBlock)("div",n,[(0,r.createElementVNode)("div",l,[(0,r.createElementVNode)("div",c,[(0,r.createElementVNode)("a",{href:O.releaseLink,target:"_blank"},(0,r.toDisplayString)(O.upgradeVersion),9,d)])]),O.latestResource?((0,r.openBlock)(),(0,r.createElementBlock)("div",i,[(0,r.createElementVNode)("div",p,[(0,r.createElementVNode)("p",g,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.upgradeStatus"))+": ",1),(0,r.createVNode)(z,{class:"ml-5",row:O.latestResource},null,8,["row"])])])])):(0,r.createCommentVNode)("",!0),O.downloadLogFailReason?((0,r.openBlock)(),(0,r.createElementBlock)("div",u,[(0,r.createElementVNode)("div",m,[(0,r.createElementVNode)("p",h,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.logStatus"))+": ",1),(0,r.createElementVNode)("span",v,(0,r.toDisplayString)(O.downloadLogFailReason),1)])])])):(0,r.createCommentVNode)("",!0),t[3]||(t[3]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1)),(0,r.createElementVNode)("div",f,[(0,r.createElementVNode)("div",y,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.os"))+": ",1),(0,r.createElementVNode)("span",N,(0,r.toDisplayString)(O.repoInfo.release.os),1)]),(0,r.createElementVNode)("div",V,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.productLabel"))+": ",1),(0,r.createElementVNode)("span",E,(0,r.toDisplayString)(O.repoInfo.release.harvester),1)])]),(0,r.createElementVNode)("div",w,[(0,r.createElementVNode)("div",b,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.harvesterChart"))+": ",1),(0,r.createElementVNode)("span",k,(0,r.toDisplayString)(O.repoInfo.release.harvesterChart),1)]),(0,r.createElementVNode)("div",S,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.monitoringChart"))+": ",1),(0,r.createElementVNode)("span",R,(0,r.toDisplayString)(O.repoInfo.release.monitoringChart),1)])]),(0,r.createElementVNode)("div",D,[(0,r.createElementVNode)("div",x,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.kubernetes"))+": ",1),(0,r.createElementVNode)("span",P,(0,r.toDisplayString)(O.repoInfo.release.kubernetes),1)]),(0,r.createElementVNode)("div",B,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("product.rancher"))+": ",1),(0,r.createElementVNode)("span",C,(0,r.toDisplayString)(O.repoInfo.release.rancher),1)])]),t[4]||(t[4]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))])):(0,r.createCommentVNode)("",!0),O.overallMessage?((0,r.openBlock)(),(0,r.createElementBlock)("p",I,(0,r.toDisplayString)(O.overallMessage),1)):(0,r.createCommentVNode)("",!0),O.showImage?((0,r.openBlock)(),(0,r.createElementBlock)("div",L,[(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.upgradeImage")),1),(0,r.createElementVNode)("span",M,(0,r.toDisplayString)(O.imageProgress)+"%",1)]),(0,r.createVNode)(H,{"model-value":O.imageProgress,"preferred-direction":"MORE"},null,8,["model-value"]),(0,r.createElementVNode)("p",A,(0,r.toDisplayString)(O.imageMessage),1),t[5]||(t[5]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1))])):(0,r.createCommentVNode)("",!0),(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.t("harvester.upgradePage.createRepository"))+" ",1),(0,r.createElementVNode)("span",U,(0,r.toDisplayString)(O.repoReady.isReady?e.t("harvester.upgradePage.succeeded"):e.t("harvester.upgradePage.pending")),1)]),O.repoReady.message?((0,r.openBlock)(),(0,r.createElementBlock)("p",_,(0,r.toDisplayString)(O.repoReady.message),1)):(0,r.createCommentVNode)("",!0),t[6]||(t[6]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1)),(0,r.createVNode)(W,{title:e.t("harvester.upgradePage.upgradeNode"),percent:O.nodesPercent,list:O.nodesStatus},null,8,["title","percent","list"]),t[7]||(t[7]=(0,r.createElementVNode)("p",{class:"bordered-section"},null,-1)),(0,r.createVNode)(W,{title:e.t("harvester.upgradePage.upgradeSysService"),percent:O.sysServiceTotal,list:O.sysServiceUpgradeMessage},null,8,["title","percent","list"])]),(0,r.createElementVNode)("div",G,[O.canStartedDownload?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,disabled:$.logDownloading,class:"btn role-primary mr-10",onClick:t[0]||(t[0]=e=>O.downloadLog())},[(0,r.createElementVNode)("i",{class:(0,r.normalizeClass)(["icon mr-10",[$.logDownloading?"icon-spinner icon-spin":"icon-download"]])},null,2),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(e.t("harvester.upgradePage.repoInfo.downloadLog")),1)],8,F)):(0,r.createCommentVNode)("",!0),O.latestResource.isUpgradeSucceeded?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"btn role-primary",onClick:t[1]||(t[1]=e=>O.ignoreMessage())},(0,r.toDisplayString)(e.t("harvester.upgradePage.dismissMessage")),1)):(0,r.createCommentVNode)("",!0)])])),default:(0,r.withCtx)((()=>[(0,r.renderSlot)(e.$slots,"button-content",{},(()=>[t[2]||(t[2]=(0,r.createElementVNode)("i",{class:"warning icon-fw icon icon-dot-open dot-icon"},null,-1))]),!0)])),_:3})),[[K,{placement:"bottom-left"}]])])):(0,r.createCommentVNode)("",!0)}var $=a(35664),O=a(88339),z=a(2602),H=a(12243),W=a(74562),j=a(65359),K=a(20652),Y=a(32766);const q={class:"bar-list"},J={class:"float-r text-info"},Q={class:"total-bar"},X={class:"bar"},Z={class:"custom-content"},ee={class:"warning"};function te(e,t,a,o,s,n){const l=(0,r.resolveComponent)("PercentageBar"),c=(0,r.resolveComponent)("Collapse");return(0,r.openBlock)(),(0,r.createElementBlock)("div",q,[(0,r.createElementVNode)("h4",null,[(0,r.createTextVNode)((0,r.toDisplayString)(a.title)+" ",1),(0,r.createElementVNode)("span",J,(0,r.toDisplayString)(a.percent)+"%",1)]),(0,r.createElementVNode)("div",null,[(0,r.createElementVNode)("div",null,[(0,r.createVNode)(c,{open:s.open,"onUpdate:open":t[1]||(t[1]=e=>s.open=e)},{title:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",Q,[(0,r.createElementVNode)("span",X,[(0,r.createVNode)(l,{"model-value":a.percent,"preferred-direction":"MORE"},null,8,["model-value"])]),(0,r.createElementVNode)("span",{class:"on-off",onClick:t[0]||(t[0]=(...e)=>n.handleSwitch&&n.handleSwitch(...e))},(0,r.toDisplayString)(s.open?e.t("harvester.generic.close"):e.t("harvester.generic.open")),1)])])),default:(0,r.withCtx)((()=>[(0,r.createElementVNode)("div",Z,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.list,((e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t},[(0,r.createElementVNode)("p",null,[(0,r.createTextVNode)((0,r.toDisplayString)(e.name)+" ",1),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["status",{[e.state]:!0}])},(0,r.toDisplayString)(e.state),3)]),(0,r.createVNode)(l,{"model-value":e.percent,"preferred-direction":"MORE"},null,8,["model-value"]),(0,r.createElementVNode)("p",ee,(0,r.toDisplayString)(e.message),1)])))),128))])])),_:1},8,["open"])])])])}var ae=a(57142),re={name:"HarvesterUpgradeProgressList",components:{PercentageBar:H.A,Collapse:ae.A},props:{title:{type:String,default:""},percent:{type:Number,default:0},list:{type:Array,default:()=>[]}},data(){return{open:!0}},methods:{handleSwitch(){this.open=!this.open}}},oe=(a(46183),a(47433));const se=(0,oe.A)(re,[["render",te],["__scopeId","data-v-1acd4c96"]]);var ne=se,le={name:"HarvesterUpgradeHeader",components:{PercentageBar:H.A,ProgressBarList:ne,BadgeStateFormatter:W.A},async fetch(){const e={};this.$store.getters["harvester/schemaFor"](Y.rk.IMAGE)&&(e.images=this.$store.dispatch("harvester/findAll",{type:Y.rk.IMAGE})),this.$store.getters["harvester/schemaFor"](Y.rk.UPGRADE)&&(e.upgrades=this.$store.dispatch("harvester/findAll",{type:Y.rk.UPGRADE})),this.$store.getters["harvester/schemaFor"]($.NW)&&(e.nodes=this.$store.dispatch("harvester/findAll",{type:$.NW})),this.$store.getters["harvester/schemaFor"](Y.rk.UPGRADE_LOG)&&(e.upgradeLogs=this.$store.dispatch("harvester/findAll",{type:Y.rk.UPGRADE_LOG})),await(0,O.kR)(e)},data(){return{filename:"",logDownloading:!1}},computed:{...(0,j.L8)(["currentProduct","isVirtualCluster"]),enabled(){return this.isVirtualCluster&&this.currentProduct.name===K.KR},latestResource(){return this.$store.getters["harvester/all"](Y.rk.UPGRADE).find((e=>e.isLatestUpgrade))},latestUpgradeLogResource(){const e=`${this.latestResource.id}-upgradelog`;return this.$store.getters["harvester/all"](Y.rk.UPGRADE_LOG).find((t=>t.id===e))},downloadLogFailReason(){if(!this.filename){const e=this.latestUpgradeLogResource?.latestArchivesFileName;return this.latestUpgradeLogResource?.downloadArchivesStatus(e)}return this.latestUpgradeLogResource?.downloadArchivesStatus(this.filename)},canStartedDownload(){return this.latestUpgradeLogResource?.canStartedDownload||!1},overallMessage(){return this.latestResource?.overallMessage},upgradeImage(){const e=this.latestResource?.upgradeImage;return this.$store.getters["harvester/all"](Y.rk.IMAGE).find((t=>t.id===e))},imageProgress(){return this.upgradeImage?.progress||0},showImage(){return!this.latestResource.isUpgradeSucceeded},imageMessage(){return this.latestResource?.upgradeImageMessage},repoReady(){return this.latestResource.createRepo},isShow(){return this.latestResource&&!this.latestResource.hasReadMessage},nodesStatus(){return this.latestResource?.nodeUpgradeMessage},sysServiceUpgradeMessage(){return this.latestResource?.sysServiceUpgradeMessage},sysServiceTotal(){return this.sysServiceUpgradeMessage?.[0].percent||0},nodesPercent(){return this.latestResource?.nodeTotalPercent||0},repoInfo(){return this.latestResource.repoInfo},releaseLink(){return`https://github.com/harvester/harvester/releases/tag/${this.latestResource?.spec?.version}`},upgradeVersion(){return this.latestResource?.spec?.version}},methods:{ignoreMessage(){this.latestResource.setLabel(z.r.REAY_MESSAGE,"true"),this.latestResource.save()},async generateLogFileName(){const e=await this.latestUpgradeLogResource.doActionGrowl("generate");this.filename=e?.data},waitFileGeneratedReady(){const e=this.latestUpgradeLogResource.id;return new Promise((t=>{let a;const r=setInterval((async()=>{a=await this.$store.dispatch("harvester/find",{type:Y.rk.UPGRADE_LOG,id:e,opt:{force:!0}},{root:!0}),a.fileIsReady(this.filename)&&(this.logDownloading=!1,clearInterval(r),t())}),2500)}))},async downloadLog(){this.logDownloading=!0,await this.generateLogFileName(),this.waitFileGeneratedReady().then((()=>{this.downloadLogFailReason||this.latestUpgradeLogResource.downloadLog(this.filename),this.logDownloading=!1}))}}};a(80168),a(54782);const ce=(0,oe.A)(le,[["render",T],["__scopeId","data-v-5745bf0e"]]);var de=ce},81128:function(e,t,a){"use strict";a.r(t);var r=a(36758),o=a.n(r),s=a(40935),n=a.n(s),l=n()(o());l.push([e.id,".upgrade-header-dropdown .v-popper__arrow-container{display:none}",""]),t["default"]=l},85054:function(e,t,a){"use strict";a.r(t);var r=a(36758),o=a.n(r),s=a(40935),n=a.n(s),l=n()(o());l.push([e.id,"a[data-v-5745bf0e]{float:right;color:var(--link)!important;text-decoration:none}.upgrade[data-v-5745bf0e]{height:100%;min-width:40px;display:flex;align-items:center}.upgrade .dot-icon[data-v-5745bf0e]{font-size:24px;vertical-align:middle;color:#00a483}.upgrade-info[data-v-5745bf0e]{min-width:550px;max-height:90vh;overflow-y:scroll}.upgrade-info .repoInfo .col span[data-v-5745bf0e]{word-break:break-all}.upgrade-info .repoInfo p.state[data-v-5745bf0e]{display:flex;align-items:center}.upgrade-info .error[data-v-5745bf0e]{color:var(--error)}.upgrade-info .float-r[data-v-5745bf0e]{float:right}.upgrade-info p[data-v-5745bf0e]{word-break:break-word;margin-top:5px}.footer[data-v-5745bf0e]{display:flex;justify-content:flex-end}",""]),t["default"]=l},64935:function(e,t,a){"use strict";a.r(t);var r=a(36758),o=a.n(r),s=a(40935),n=a.n(s),l=n()(o());l.push([e.id,".bar-list .float-r[data-v-1acd4c96]{float:right}.bar-list .total-bar[data-v-1acd4c96]{display:flex;-webkit-user-select:none;-moz-user-select:none;user-select:none}.bar-list .total-bar>.bar[data-v-1acd4c96]{width:85%}.bar-list .total-bar .on-off[data-v-1acd4c96]{margin-left:10px;cursor:pointer}.bar-list .custom-content[data-v-1acd4c96]{margin-bottom:14px}.bar-list .custom-content p[data-v-1acd4c96]{margin-bottom:4px}.bar-list .custom-content .status[data-v-1acd4c96]{float:right}.bar-list .custom-content .Pending[data-v-1acd4c96],.bar-list .custom-content .Succeeded[data-v-1acd4c96],.bar-list .custom-content .Upgrading[data-v-1acd4c96]{color:var(--success)}.bar-list .custom-content .failed[data-v-1acd4c96],.bar-list .custom-content .warning[data-v-1acd4c96]{color:var(--error)}",""]),t["default"]=l},80168:function(e,t,a){var r=a(81128);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("391b5cb5",r,!0,{sourceMap:!1,shadowMode:!1})},54782:function(e,t,a){var r=a(85054);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("68e9c16a",r,!0,{sourceMap:!1,shadowMode:!1})},46183:function(e,t,a){var r=a(64935);r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals);var o=a(74825).A;o("d190e44a",r,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=harvester-1.6.0.umd.min.472.js.map